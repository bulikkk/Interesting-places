<!DOCTYPE html>
<html>
  <head>
      <title>.point</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta charset="utf-8">
      <link rel="stylesheet" type="text/css" href="../../static/css/main.css">
  </head>
  <body>
    <div id="navbar">
        <div id="brand">
            <a class="navbar-brand" href="{% url 'main' %}">
                <h1>.point</h1>
            </a>
        </div>
        {% block content %}

        {% endblock %}
    </div>
    <div id="map"></div>
    <script>
      function initMap() {

    var styledMapType = new google.maps.StyledMapType(
        [
            { "elementType": "geometry", "stylers": [ { "color": "#242f3e" },
            { "visibility": "on" } ] },
            { "elementType": "geometry.fill", "stylers": [ { "saturation": -30 }, { "weight": 2 } ] },
            { "elementType": "labels.text.fill", "stylers": [ { "color": "#746855" } ] },
            { "elementType": "labels.text.stroke", "stylers": [ { "color": "#242f3e" } ] },
            { "featureType": "administrative", "elementType": "geometry", "stylers": [ { "visibility": "off" } ] },
            { "featureType": "administrative.locality", "elementType": "labels.text.fill", "stylers": [ { "color": "#d59563" } ] },
            { "featureType": "poi", "stylers": [ { "visibility": "off" } ] },
            { "featureType": "poi", "elementType": "labels.text.fill", "stylers": [ { "color": "#d59563" } ] },
            { "featureType": "poi.park", "elementType": "geometry", "stylers": [ { "color": "#263c3f" } ] },
            { "featureType": "poi.park", "elementType": "labels.text.fill", "stylers": [ { "color": "#6b9a76" } ] },
            { "featureType": "road", "stylers": [ { "weight": 2 } ] },
            { "featureType": "road", "elementType": "geometry", "stylers": [ { "color": "#38414e" } ] },
            { "featureType": "road", "elementType": "geometry.stroke", "stylers": [ { "color": "#212a37" }, { "visibility": "off" } ] },
            { "featureType": "road", "elementType": "labels.icon", "stylers": [ { "visibility": "off" } ] },
            { "featureType": "road", "elementType": "labels.text.fill", "stylers": [ { "color": "#9ca5b3" } ] },
            { "featureType": "road.highway", "elementType": "geometry", "stylers": [ { "color": "#746855" } ] },
            { "featureType": "road.highway", "elementType": "geometry.stroke", "stylers": [ { "color": "#1f2835" } ] },
            { "featureType": "road.highway", "elementType": "labels.text.fill", "stylers": [ { "color": "#f3d19c" } ] },
            { "featureType": "transit", "stylers": [ { "visibility": "off" } ] },
            { "featureType": "transit", "elementType": "geometry", "stylers": [ { "color": "#2f3948" } ] },
            { "featureType": "transit.station", "elementType": "labels.text.fill", "stylers": [ { "color": "#d59563" } ] },
            { "featureType": "water", "elementType": "geometry", "stylers": [ { "color": "#17263c" } ] },
            { "featureType": "water", "elementType": "labels.text.fill", "stylers": [ { "color": "#515c6d" } ] },
            { "featureType": "water", "elementType": "labels.text.stroke", "stylers": [ { "color": "#17263c" } ] }
        ],
        {name: 'Dark Map'}
    );

    var map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 52.2297, lng: 21.0122},
        zoom: 16,
        mapTypeControlOptions: {
            mapTypeIds: ['styled_map']
        }
    });

    map.mapTypes.set('styled_map', styledMapType);
    map.setMapTypeId('styled_map');

    infoWindow = new google.maps.InfoWindow;

    {% for place in places %}
        var p = {
            lat: {{ place.position_lat | safe }},
            lng: {{ place.position_lng | safe }}
        }
        var marker = new google.maps.Marker({
            position: p,
            animation: google.maps.Animation.DROP,
            map: map,
            icon: {
                    path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',
                    fillColor: '#FF4130',
                    fillOpacity: 0.5,
                    strokeColor: '',
                    strokeWeight: 0
            }
        });
    {% endfor %}


    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            var marker = new google.maps.Marker({
                position: pos,
                animation: google.maps.Animation.DROP,
                map: map,
                icon: {
                    path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',
                    fillColor: '#00CCBB',
                    fillOpacity: 0.5,
                    strokeColor: '',
                    strokeWeight: 0
                }
            });

            map.setCenter(pos);
        }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
        });
    }
    else {
        handleLocationError(false, infoWindow, map.getCenter());
    }
}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
    infoWindow.open(map);
}
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD0MvgxV7JmYsbUBa4vi2tgiwsQFPtHDHk&callback=initMap">
    </script>
  </body>
</html>